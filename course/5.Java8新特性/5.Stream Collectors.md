# Stream Collectors

![java-8-collectors](https://tva1.sinaimg.cn/large/008eGmZEly1gozme2ztxaj30dw07at9m.jpg)

作为流的最后一步，收集器`Collectors`是至关主要的一环。`Stream.collect()`是Java 8的Stream API的terminal方法之一。它允许我们对流实例中的数据元素执行可变的折叠操作, 比如将元素重新打包到一些数据结构中，并应用一些额外的逻辑，将它们连接起来，等等。

## Collectors类

此类为我们提供了所有的预定义实现，我们只需要在代码中引入即可：

```java
import static java.util.stream.Collectors.*;
```

## 常用收集器

### 1. Collectors.toList()

ToList收集器可用于将所有流元素收集到List实例中。需要记住的重要事情是，我们不能假定使用这个方法实现任何特定的列表。如果您希望对此有更多的控制，则使用toCollection代替。

```java
List<String> list = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.toList());
```

Java 10 给我们提供了一种将流转换为不可变集合的方法：`Collectors.toUnmodifiableList()`。

```java
List<String> list = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.toUnmodifiableList());
```

### 2. Collectors.toSet()

ToSet收集器用于将所有流元素收集到Set实例中, 由于Set中的元素不能重复，所以这个方法也给我们提供了一种流元素去重的方法！需要记住的重要事情是，我们不能假定使用这个方法实现任何特定的列表。如果您希望对此有更多的控制，则使用toCollection代替。

```java
Stream.of("a", "dd", "bb", "ccc", "dd").collect(Collectors.toSet()).forEach(System.out::println);// a bb ccc dd
```
Java 10 给我们提供了一种将流转换为不可变集合的方法：`Collectors.toUnmodifiableSet()`。

### 3. Collectors.toCollection()

通过前面的toSet和toList收集器的学习，我们可能已经注意到的，这两个收集器不能对它们的实现做任何提前的预计。如果希望使用自定义实现，则需要使用toCollection收集器和所提供的选择类型来实现相应的集合。

例如，我们想实现LinkedList的集合：
```java
LinkedList<String> stringLinkedList = Stream.of("a", "dd", "bb", "ccc", "dd").collect(Collectors.toCollection(LinkedList::new));
```

### 4. Collectors.toMap()

ToMap收集器被用于收集一个流里面的元素到一个Map实例里，为了完成这个功能，我们必须要实现两个函数：
* keyMapper：will be used for extracting a Map key from a Stream element
* valueMapper:will be used for extracting a value associated with a given key.

例如：我们将封装一个字符流为map，key为字符串本身，value为字符串的长度：
```java
Map<String, Integer> map = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.toMap(Function.identity(), String::length));
// {bb=2, dd=2, a=1, ccc=3}
```

上面代码中的`Function.identity()`是一个定义函数的缩写，这个函数表示接受的函数和返回值是同样的。
我们需要注意的是，如果toMap发现生成的key里面包含了多个重复的值，将会抛出IllegalStateException异常。

Java 10 给我们提供了一种将流转换为不可变Map的方法：`Collectors.toUnmodifiableMap()`。

### 5. Collectors.collectingAndThen()

`CollectingAndThen`是一个特殊的收集器，它允许在收集结束后直接对结果执行另一个操作。

```java
Stream.of("a", "bb", "ccc", "dd").collect(Collectors.collectingAndThen(Collectors.toList(), Collections::<String>unmodifiableList));
```

### 6. Collectors.joining()

Joining collector can be used for joining Stream<String> elements.

例如：
```java
String str = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.joining());//abbcccdd
String str = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.joining(","));//a,bb,ccc,dd
String str = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.joining(" ", "PRE-", "-POST"));//PRE-a bb ccc dd-POST
```
### 7.Collectors.summarizingDouble/Long/Int()

Collectors.summarizingDouble/Long/Int()是一个收集器，它返回一个特殊的类，该类包含关于已提取元素流中的数字数据的统计信息。

例如：
```java
IntSummaryStatistics intSummaryStatistics = Stream.of("a", "bb", "ccc", "dd").collect(Collectors.summarizingInt(String::length));
System.out.println(intSummaryStatistics.getMax()); // 3
System.out.println(intSummaryStatistics.getAverage()); // 2.0
System.out.println(intSummaryStatistics.getSum()); // 8
System.out.println(intSummaryStatistics.getCount()); // 4
System.out.println(intSummaryStatistics.getMin()); // 1
```

另外，Collectors.averagingDouble/Long/Int() 与 Collectors.summingDouble/Long/Int()作用与上面的计算类似。


